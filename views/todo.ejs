<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>TODO List - Quản lý công việc</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
  </head>
  <body
    class="bg-gradient-to-br from-[#0f2027] via-[#2c5364] to-[#f7ff00] min-h-screen flex flex-col"
  >
    <!-- Nút về trang chủ -->
    <div class="absolute top-8 left-8 z-20">
      <button
        onclick="window.location.href='/'"
        class="flex items-center gap-2 px-4 py-2 rounded-full bg-cyan-500 hover:bg-cyan-600 text-white font-bold shadow transition"
      >
        <span class="ph ph-arrow-left text-lg"></span>
        Trang chủ
      </button>
    </div>

    <!-- Khung chính -->
    <div class="flex flex-col flex-1 items-center justify-center">
      <div class="w-full max-w-xl mx-auto">
        <header class="mb-8 text-center">
          <h1
            class="text-3xl font-extrabold text-cyan-300 drop-shadow-lg flex items-center justify-center gap-2"
          >
            <span class="ph ph-list-checks text-cyan-400"></span>
            Quản lý công việc
          </h1>
          <p class="text-cyan-200 mt-2">
            Cùng tổ chức công việc, hoàn thành mục tiêu!
          </p>
        </header>

        <!-- Form thêm công việc -->
        <form id="todo-form" class="flex gap-3 mb-8">
          <input
            type="text"
            id="todo-input"
            placeholder="Nhập công việc cần làm..."
            class="flex-1 px-4 py-3 rounded-xl bg-white text-gray-500 placeholder:text-gray-400 border-2 border-cyan-200 focus:outline-none focus:ring-2 focus:ring-cyan-400 shadow-inner transition"
            required
          />
          <button
            type="submit"
            class="px-6 py-3 rounded-xl bg-gradient-to-r from-cyan-500 to-cyan-400 shadow-lg font-bold text-white hover:scale-105 transition-transform"
          >
            <span class="ph ph-plus"></span>
            Thêm
          </button>
        </form>

        <!-- Container cho list -->
        <div
          class="bg-white/60 backdrop-blur-xl border-2 border-cyan-200 shadow-2xl rounded-2xl p-6 mb-4"
          style="max-height: 340px; overflow-y: auto"
        >
          <ul id="todo-list" class="mt-2">
            <% tasks.forEach(task => { %>
            <li
              class="flex items-center justify-between bg-white/80 border border-cyan-100 shadow py-3 px-5 rounded-xl group transition-all"
            >
              <span
                class="task-text text-gray-900 font-semibold flex items-center gap-3"
              >
                <span
                  class="<%= task.completed ? 'ph ph-check-circle text-green-500 text-xl icon-status' : 'ph ph-circle text-cyan-400 text-xl icon-status' %>"
                ></span>
                <span
                  class="task-label <%= task.completed ? 'line-through text-gray-400' : '' %>"
                  ><%= task.text %></span
                >
              </span>
              <div class="flex gap-2">
                <button
                  class="mark-btn px-3 py-2 rounded-lg <%= task.completed ? 'bg-yellow-500 hover:bg-yellow-600' : 'bg-cyan-500 hover:bg-cyan-600' %> text-white font-medium shadow transition flex items-center gap-2"
                  data-id="<%= task.id %>"
                >
                  <span
                    class="<%= task.completed ? 'ph ph-arrow-counter-clockwise' : 'ph ph-check' %>"
                  ></span>
                  <%= task.completed ? 'Unmark' : 'Mark' %>
                </button>
                <button
                  class="remove-btn px-3 py-2 rounded-lg bg-gray-300 hover:bg-red-400 text-gray-700 hover:text-white font-medium shadow transition flex items-center gap-2"
                  data-id="<%= task.id %>"
                >
                  <span class="ph ph-trash"></span>
                  Remove
                </button>
              </div>
            </li>
            <% }) %>
          </ul>

          <!-- Empty State -->
          <% if (tasks.length === 0) { %>
          <div
            id="empty-state"
            class="flex flex-col items-center justify-center py-8 text-center text-cyan-300"
          >
            <span
              class="ph ph-umbrella-simple text-5xl mb-4 animate-bounce"
            ></span>
            <div class="text-lg font-semibold">Chưa có công việc nào</div>
            <div class="text-cyan-200 mt-2">
              Hãy nhập công việc cần làm ở trên để bắt đầu ngày mới năng động!
            </div>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <script>
      const form = document.getElementById("todo-form");
      const input = document.getElementById("todo-input");

      // Add
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;
        await fetch("/api/tasks", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ text }),
        });
        window.location.reload();
      });

      // Mark / Unmark / Delete
      document.addEventListener("click", async (e) => {
        const btn = e.target;
        const id = btn.dataset.id;
        if (btn.classList.contains("mark-btn")) {
          await fetch(`/api/tasks/${id}`, { method: "PUT" });
          window.location.reload();
        } else if (btn.classList.contains("remove-btn")) {
          await fetch(`/api/tasks/${id}`, { method: "DELETE" });
          window.location.reload();
        }
      });
    </script>

    <style>
      .animate-bounce {
        animation: bounce 1.2s infinite alternate;
      }
      @keyframes bounce {
        from {
          transform: translateY(0);
        }
        to {
          transform: translateY(-10px);
        }
      }
      /* Custom scroll bar cho container - LỚN hơn và dễ bấm */
      div[style*="overflow-y: auto"]::-webkit-scrollbar {
        width: 16px;
        background: #e0f7fa;
        border-radius: 8px;
      }
      div[style*="overflow-y: auto"]::-webkit-scrollbar-thumb {
        background: #06b6d4;
        border-radius: 8px;
        border: 4px solid #e0f7fa;
      }
      div[style*="overflow-y: auto"]::-webkit-scrollbar-thumb:hover {
        background: #0891b2;
      }
      /* Firefox */
      div[style*="overflow-y: auto"] {
        scrollbar-width: auto;
        scrollbar-color: #06b6d4 #e0f7fa;
      }
    </style>

    <!-- Footer -->
    <footer
      class="w-full bg-gradient-to-r from-cyan-500 via-blue-400 to-yellow-300 py-1 mt-12 shadow-inner"
    >
      <div class="max-w-4xl mx-auto text-center text-white/90">
        <p class="font-medium">
          &copy; <%= new Date().getFullYear() %> My Group Website
        </p>
        <div class="flex justify-center gap-4 mt-2">
          <a href="/" class="hover:text-white transition">Trang chủ</a>
          <a href="/todo" class="hover:text-white transition">TODO List</a>
          <a
            href="https://group-web-tailwind-1.onrender.com/"
            class="hover:text-white transition"
            >Liên hệ</a
          >
        </div>
      </div>
    </footer>
  </body>
</html>
